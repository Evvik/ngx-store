{"version":3,"file":"webstorage.js","sourceRoot":"","sources":["../../src/decorator/webstorage.ts"],"names":[],"mappings":";;AAAA,oEAAgE;AAIhE,sBAA6B,GAAY;IACrC,MAAM,CAAmB,kBAAU,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;AAC3D,CAAC;AAFD,oCAEC;AAED,wBAA+B,GAAY;IACvC,MAAM,CAAmB,kBAAU,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC;AAC7D,CAAC;AAFD,wCAEC;AAED,uBAAuB;AACvB,IAAI,KAAK,GAAG,EAAE,CAAC;AAEJ,QAAA,UAAU,GAAG,UAAC,UAAmB,EAAE,GAAW;IACrD,MAAM,CAAC,UAAC,MAAc,EAAE,YAAoB;QACxC,GAAG,GAAG,GAAG,IAAI,YAAY,CAAC;QAC1B,IAAI,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,CAAC;QACjC,IAAI,WAAW,GAAG,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;QAEzD,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,YAAY,EAAE;YACxC,GAAG,EAAE;gBACD,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC;YACD,GAAG,EAAE,UAAS,KAAU;gBACpB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC;oBAC7B,KAAK,GAAG,WAAW,CAAC;gBACxB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,KAAK,GAAG,KAAK,CAAC;oBACd,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;gBAClD,CAAC;gBACD,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;gBAElB,+BAA+B;gBAC/B,KAAK,CAAC,IAAI,GAAG;oBACT,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;gBAClD,CAAC,CAAC;gBAEF,yCAAyC;gBACzC,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACvB,KAAK,CAAC,IAAI,GAAG,UAAS,KAAK;wBACvB,IAAI,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;wBAC1D,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;wBAC9C,MAAM,CAAC,MAAM,CAAC;oBAClB,CAAC,CAAC;oBACF,KAAK,CAAC,GAAG,GAAG;wBACR,IAAI,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;wBACzD,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;wBAC9C,MAAM,CAAC,MAAM,CAAC;oBAClB,CAAC,CAAC;oBACF,KAAK,CAAC,KAAK,GAAG;wBACV,IAAI,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;wBAC3D,sCAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;wBAC9C,MAAM,CAAC,MAAM,CAAC;oBAClB,CAAC,CAAC;gBACN,CAAC;YACL,CAAC;SACJ,CAAC,CAAC;IACP,CAAC,CAAA;AACL,CAAC,CAAC","sourcesContent":["import {WebStorageUtility} from \"../utility/webstorage.utility\";\r\nimport {Webstorable} from '../index';\r\n\r\n\r\nexport function LocalStorage(key?: string): Webstorable {\r\n    return <Webstorable><any>WebStorage(localStorage, key);\r\n}\r\n\r\nexport function SessionStorage(key?: string): Webstorable {\r\n    return <Webstorable><any>WebStorage(sessionStorage, key);\r\n}\r\n\r\n// initialization cache\r\nlet cache = {};\r\n\r\nexport let WebStorage = (webStorage: Storage, key: string) => {\r\n    return (target: Object, propertyName: string): void => {\r\n        key = key || propertyName;\r\n        let proxy = target[propertyName];\r\n        let storedValue = WebStorageUtility.get(webStorage, key);\r\n\r\n        Object.defineProperty(target, propertyName, {\r\n            get: function() {\r\n                return proxy;\r\n            },\r\n            set: function(value: any) {\r\n                if (!cache[key] && storedValue) { // first setter handle\r\n                    proxy = storedValue;\r\n                } else { // if no value in localStorage, set it to initializer\r\n                    proxy = value;\r\n                    WebStorageUtility.set(webStorage, key, value);\r\n                }\r\n                cache[key] = true;\r\n\r\n                // manual method for force save\r\n                proxy.save = function() {\r\n                    WebStorageUtility.set(webStorage, key, proxy);\r\n                };\r\n\r\n                // handle methods changing value of array\r\n                if (Array.isArray(proxy)) {\r\n                    proxy.push = function(value) {\r\n                        let result = Array.prototype.push.apply(proxy, arguments);\r\n                        WebStorageUtility.set(webStorage, key, proxy);\r\n                        return result;\r\n                    };\r\n                    proxy.pop = function() {\r\n                        let result = Array.prototype.pop.apply(proxy, arguments);\r\n                        WebStorageUtility.set(webStorage, key, proxy);\r\n                        return result;\r\n                    };\r\n                    proxy.shift = function() {\r\n                        let result = Array.prototype.shift.apply(proxy, arguments);\r\n                        WebStorageUtility.set(webStorage, key, proxy);\r\n                        return result;\r\n                    };\r\n                }\r\n            },\r\n        });\r\n    }\r\n};\r\n"]}